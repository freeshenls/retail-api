<div class="fixed inset-0 flex flex-col overflow-hidden bg-slate-100 select-none">
  <%
    # 1. 基础路径与状态计算
    curr_path = request.path
    is_profile = curr_path.start_with?("/profile")

    path_users    = admin_users_path
    path_roles    = admin_roles_path
    path_invites  = admin_invites_path
    is_sys = curr_path.match?(/^\/admin\/(users|roles|invites)/)

    path_customers = admin_customers_path
    is_customer = curr_path.match?(/^\/admin\/(customers)/)

    path_unsettled = unsettled_admin_orders_path
    path_settled   = settled_admin_orders_path
    is_order = curr_path.match?(/^\/admin\/(orders)/)

    path_category = admin_categories_path
    path_service_type = admin_service_types_path
    is_param = curr_path.match?(/^\/admin\/(categories|service_types)/)

    # --- 顶部导航栏图标优化 ---
    nav_items = [
      { label: "系统配置", path: path_users, active: is_sys, icon: "wrench-screwdriver" },
      { label: "客户管理", path: path_customers, active: is_customer, icon: "user-group" },
      { label: "订单管理", path: path_unsettled, active: is_order, icon: "clipboard-document-list" },
      { label: "参数配置", path: path_category, active: is_param, icon: "adjustments-horizontal" }      
    ]

    # --- 侧边栏图标优化 ---
    # 默认：系统管理
    sidebars = { 
      title: "系统管理", 
      icon: "cog-8-tooth",
      items: [
        { label: "用户管理", path: path_users, active: curr_path == path_users, icon: "user-circle" },
        { label: "角色管理", path: path_roles, active: curr_path == path_roles, icon: "shield-check" },
        { label: "邀请码管理", path: path_invites, active: curr_path == path_invites, icon: "ticket" }
      ]
    }

    # 客户管理侧边栏
    if is_customer
      sidebars = { 
        title: "客户管理", 
        icon: "user-group",
        items: [
          { label: "信息维护", path: path_customers, active: curr_path == path_customers, icon: "identification" }
        ]
      }
    end

    # 订单管理侧边栏
    if is_order
      sidebars = { 
        title: "订单管理", 
        icon: "shopping-bag",
        items: [
          { label: "未结算订单", path: path_unsettled, active: curr_path == path_unsettled, icon: "clock" },
          { label: "已结算订单", path: path_settled, active: curr_path == path_settled, icon: "check-badge" }
        ]
      }
    end

    # 订单管理侧边栏
    if is_param
      sidebars = { 
        title: "参数配置", 
        icon: "cpu-chip",
        items: [
          { label: "规格类型", path: path_category, active: curr_path == path_category, icon: "tag" },
          { label: "服务定价", path: path_service_type, active: curr_path == path_service_type, icon: "currency-yen" }
        ]
      }
    end

    # 个人中心侧边栏
    if is_profile
      sidebars = { 
        title: "账号信息",
        icon: "fingerprint", 
        items: [
          { label: "个人中心", path: profile_path, active: curr_path == profile_path, icon: "user-gear"}
        ]
      }
    end
  %>

  <%# --- 顶部导航栏 --- %>
  <%= render Layout::NavbarComponent.new(
        nav_items: nav_items, 
        avatar: current_user.avatar,
        user_name: current_user.name, 
        role: current_user.role.description
      ) %>

  <main class="flex flex-1 overflow-hidden">
    <%# --- 侧边栏区域 --- %>
    <aside class="h-full shrink-0 relative z-20">
      <%= render Layout::SidebarComponent.new(**sidebars) %>
    </aside>

    <%# --- 右侧内容主区 --- %>
    <div class="flex-1 flex flex-col min-w-0 bg-slate-50 relative z-10">
      
      <%# 标签切换页签 %>
      <div id="tabs" class="h-10 shrink-0 border-b border-slate-200 bg-white">
        <%= render Layout::TabSwitcherComponent.new(tabs: @cookie_tabs) %>
      </div>

      <%# 业务内容动态加载区 %>
      <div class="flex-1 overflow-y-auto p-4 lg:p-6 shadow-inner">
        <%# 这里的 main_content 是点击侧边栏/通知列表跳转的核心目标 %>
        <%= turbo_frame_tag "main_content" do %>
          <%= yield %>
        <% end %>
      </div>
    </div>
  </main>
</div>
  