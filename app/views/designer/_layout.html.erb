<div class="fixed inset-0 flex flex-col overflow-hidden bg-slate-100 select-none">
  <%
    # 1. 基础路径与状态计算
    curr_path = request.path
    is_profile = curr_path.start_with?("/profile")

    path_new       = new_designer_order_path
    path_pending   = pending_designer_orders_path
    path_completed = completed_designer_orders_path

    is_order = curr_path.start_with?("/designer/orders")

    nav_items = [
      { label: "订单管理", path: path_new, active: is_order, icon: "shopping-cart" }
    ]

    sidebars = { 
      title: "业务订单", 
      icon: "shopping-cart",
      submenus: [{ 
        label: "我的订单", 
        icon: "clipboard-document-list", 
        active: true,
        items: [
          { label: "新增订单", path: path_new, active: curr_path == path_new },
          { label: "待提交订单", path: path_pending, active: curr_path == path_pending },
          { label: "已提交订单", path: path_completed, active: curr_path == path_completed }
        ]
      }]
    }

    sidebars = { 
      title: "信息维护",
      icon: "squares-2x2", 
      items: [
        { label: "个人中心", path: profile_path, active: request.path == profile_path, icon: "user"}
      ]
    } if is_profile
  %>

  <%# --- 顶部导航栏 --- %>
  <%= render Layout::NavbarComponent.new(
        nav_items: nav_items, 
        avatar: current_user.avatar,
        user_name: current_user.name, 
        role: current_user.role.description
      ) do |navbar| %>

    <%# 正确注入插槽内容 %>
    <% navbar.with_notification do %>
      <% 
        # 实时获取该设计师审核通过的订单
        approved_orders = Biz::Order.for_designer(current_user)
                              .where(status: :approved, is_settled: false)
                              .order(updated_at: :desc)
      %>
      <%= render "designer/orders/approved_notification", 
                 orders: approved_orders, 
                 count: approved_orders.count %>
    <% end %>
  <% end %> <%# --- 确保 Navbar 组件在这里闭合 --- %>

  <main class="flex flex-1 overflow-hidden">
    <%# --- 侧边栏区域 --- %>
    <aside class="h-full shrink-0 relative z-20">
      <%= render Layout::SidebarComponent.new(**sidebars) %>
    </aside>

    <%# --- 右侧内容主区 --- %>
    <div class="flex-1 flex flex-col min-w-0 bg-slate-50 relative z-10">
      
      <%# 标签切换页签 %>
      <div id="tabs" class="h-10 shrink-0 border-b border-slate-200 bg-white">
        <%= render Layout::TabSwitcherComponent.new(tabs: @cookie_tabs) %>
      </div>

      <%# 业务内容动态加载区 %>
      <div class="flex-1 overflow-y-auto p-4 lg:p-6 shadow-inner">
        <%# 这里的 main_content 是点击侧边栏/通知列表跳转的核心目标 %>
        <%= turbo_frame_tag "main_content" do %>
          <%= yield %>
        <% end %>
      </div>
    </div>
  </main>
</div>

  <% if user_signed_in? %>
    <%= turbo_stream_from "notifications_user_#{current_user.id}" %>
  <% end %>