<%# app/components/admin/service_type_edit_component.html.erb %>
<div class="max-w-2xl mx-auto py-8">
  <div class="mb-6 flex items-center gap-3 px-2">
    <%= link_to admin_service_types_path, data: { turbo: false }, class: "text-slate-400 hover:text-[#0066b3] transition-colors" do %>
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
    <% end %>
    <h2 class="text-sm font-bold text-slate-700 uppercase tracking-wider">调整定价策略</h2>
  </div>

  <div class="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden">
    <div class="bg-slate-50/50 px-8 py-5 border-b border-slate-100 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="w-1.5 h-4 bg-orange-400 rounded-full"></span>
        <h3 class="text-sm font-black text-slate-700 uppercase">价格信息变更</h3>
      </div>
      <span class="text-[10px] font-bold text-slate-400 font-mono italic uppercase">ID: <%= @service_type.id %></span>
    </div>

    <%= form_with(model: [:admin, @service_type], url: admin_service_type_path(@service_type), method: :patch, data: { turbo: false }, class: "divide-y divide-slate-100") do |f| %>
      <div class="p-8 space-y-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          
          <%# 1. 服务类型名称 %>
          <div class="space-y-2">
            <label class="text-[11px] font-black text-slate-400 tracking-widest ml-1 uppercase">服务项目名称</label>
            <%= f.text_field :service_type, class: "block w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm font-bold text-slate-700 focus:bg-white focus:ring-4 focus:ring-[#0066b3]/5 focus:border-[#0066b3] transition-all outline-none shadow-sm" %>
          </div>

          <%# 2. 适用规格 - Dropdown %>
          <div class="space-y-2">
            <label class="text-[11px] font-black text-slate-400 tracking-widest ml-1 uppercase">适用业务规格</label>
            <div class="relative group" data-controller="dropdown admin--service-type-edit-component">
              <button type="button" 
                      data-action="dropdown#toggle click@window->dropdown#hide" 
                      class="w-full flex items-center justify-between py-2.5 px-4 bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg font-bold hover:border-[#0066b3] transition-all shadow-sm">
                <span data-admin--service-type-edit-component-target="labelName">
                  <%= @service_type.category&.name || "选择规格..." %>
                </span>
                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>

              <%= f.hidden_field :category_id, data: { "admin--service-type-edit-component-target": "hiddenInput" } %>

              <div data-dropdown-target="menu" class="hidden absolute z-50 mt-2 w-full bg-white border border-slate-200 rounded-xl shadow-xl py-1.5 animate-in fade-in zoom-in-95 duration-100 ring-1 ring-black/5">
                <% Biz::Category.order(:position).each do |cat| %>
                  <button type="button" 
                          data-action="click->admin--service-type-edit-component#selectItem"
                          data-admin--service-type-edit-component-id-param="<%= cat.id %>"
                          data-admin--service-type-edit-component-name-param="<%= cat.name %>"
                          class="w-full text-left px-4 py-2.5 text-sm font-bold text-slate-600 hover:bg-[#0066b3]/5 hover:text-[#0066b3] transition-colors border-b border-slate-50 last:border-0">
                    <%= cat.name %>
                  </button>
                <% end %>
              </div>
            </div>
          </div>

          <%# 3. 基准价格 %>
          <div class="space-y-2">
            <label class="text-[11px] font-black text-slate-400 tracking-widest ml-1 uppercase">基准价格 (￥)</label>
            <div class="relative group">
              <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none text-slate-400 group-focus-within:text-[#0066b3] font-black italic">￥</div>
              <%= f.number_field :price, step: 0.0001, class: "block w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm font-mono font-black text-slate-700 focus:bg-white focus:ring-4 focus:ring-[#0066b3]/5 focus:border-[#0066b3] transition-all outline-none shadow-sm" %>
            </div>
          </div>

          <%# 4. 状态控制 - Dropdown %>
          <div class="space-y-2">
            <label class="text-[11px] font-black text-slate-400 tracking-widest ml-1 uppercase">当前运营状态</label>
            <div class="relative group" data-controller="dropdown admin--service-type-edit-component">
              <button type="button" 
                      data-action="dropdown#toggle click@window->dropdown#hide" 
                      class="w-full flex items-center justify-between py-2.5 px-4 bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg font-bold hover:border-[#0066b3] transition-all shadow-sm">
                <span data-admin--service-type-edit-component-target="labelName">
                  <%= @service_type.status == "1" ? "正常启用" : "已禁用" %>
                </span>
                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>

              <%= f.hidden_field :status, data: { "admin--service-type-edit-component-target": "hiddenInput" } %>

              <div data-dropdown-target="menu" class="hidden absolute z-50 mt-2 w-full bg-white border border-slate-200 rounded-xl shadow-xl py-1.5 animate-in fade-in zoom-in-95 duration-100 ring-1 ring-black/5">
                <button type="button" 
                        data-action="click->admin--service-type-edit-component#selectItem"
                        data-admin--service-type-edit-component-id-param="1"
                        data-admin--service-type-edit-component-name-param="正常启用"
                        class="w-full text-left px-4 py-2.5 text-sm font-bold text-slate-600 hover:bg-emerald-50 hover:text-emerald-600 transition-colors">
                  正常启用
                </button>
                <button type="button" 
                        data-action="click->admin--service-type-edit-component#selectItem"
                        data-admin--service-type-edit-component-id-param="0"
                        data-admin--service-type-edit-component-name-param="已禁用"
                        class="w-full text-left px-4 py-2.5 text-sm font-bold text-slate-600 hover:bg-red-50 hover:text-red-600 transition-colors">
                  已禁用
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <%# 底部操作栏 %>
      <div class="px-8 py-6 bg-slate-50/50 flex items-center justify-between">
        <p class="text-[10px] text-slate-400 italic font-medium tracking-tight">
          最后更新时间：<%= @service_type.updated_at.strftime("%Y-%m-%d %H:%M") %>
        </p>
        <div class="flex items-center gap-4">
          <%= link_to "放弃变更", admin_service_types_path, data: { turbo: false }, class: "text-xs font-bold text-slate-400 hover:text-slate-600" %>
          <%= f.submit "保存并应用", class: "px-10 py-2.5 bg-[#0066b3] text-white text-xs font-black rounded-lg shadow-md hover:bg-[#005596] active:scale-95 transition-all cursor-pointer tracking-widest" %>
        </div>
      </div>
    <% end %>
  </div>
</div>
