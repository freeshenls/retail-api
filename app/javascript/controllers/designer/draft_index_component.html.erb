<%# app/components/designer/draft_index_component.html.erb %>
<div data-controller="designer--draft-index-component" class="w-full space-y-4">
  
  <%# 1. 顶部搜索过滤栏 - 色调微调以匹配品牌 %>
  <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
    <%= form_with url: helpers.designer_drafts_path, method: :get, 
                  data: { turbo_frame: "main_content", turbo_action: "advance" }, 
                  class: "flex items-center gap-3" do |f| %>
      
      <div class="relative flex-1 max-w-sm">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400">
          <%= heroicon "magnifying-glass", variant: :outline, options: { class: "h-4 w-4" } %>
        </div>
        <%= f.text_field :search, value: @params[:search], placeholder: "搜索稿件名称...",
              class: "block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg bg-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-[#0066b3]/20 focus:border-[#0066b3] sm:text-sm transition-all" %>
      </div>

      <div class="flex gap-2">
        <%= f.submit "搜索", class: "px-4 py-2 bg-[#0066b3] text-white text-sm font-bold rounded-lg hover:bg-[#005596] cursor-pointer shadow-sm transition-all" %>
        
        <% if @params[:search].present? %>
          <%= link_to "重置", helpers.designer_drafts_path, 
                      data: { turbo_frame: "main_content" },
                      class: "px-4 py-2 bg-slate-100 text-slate-600 text-sm font-medium rounded-lg hover:bg-slate-200 transition" %>
        <% end %>
      </div>
    <% end %>
  </div>

  <%# 2. 数据表格区域 %>
  <div class="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-200">
        <thead class="bg-slate-50/50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">稿件名称</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">文件类型</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">上传时间</th>
            <th scope="col" class="px-6 py-3 text-right text-xs font-bold text-slate-500 uppercase tracking-wider">操作</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-200 bg-white text-slate-700">
  <% @drafts.each do |draft| %>
    <tr class="hover:bg-slate-50/50 transition-colors group">
      <%# 1. 稿件名称：仅通过颜色变化提示点击，去掉图标和下划线 %>
      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
        <%= link_to draft.name, helpers.designer_draft_path(draft), 
                    data: { turbo_frame: "main_content" },
                    class: "text-slate-900 group-hover:text-[#0066b3] transition-colors cursor-pointer" %>
      </td>

      <td class="px-6 py-4 whitespace-nowrap">
        <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-slate-100 text-slate-600 border border-slate-200 uppercase">
          <%= draft.file_type.to_s.split('/').last %>
        </span>
      </td>

      <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
        <%= format_time(draft) %>
      </td>

      <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
        <%= link_to "详情", helpers.designer_draft_path(draft), 
                    data: { turbo_frame: "main_content" }, 
                    class: "text-[#0066b3] hover:text-[#005596] font-bold" %>
      </td>
    </tr>
  <% end %>
</tbody>
      </table>
    </div>

    <%# 3. Pagy v43 分页底栏 - 核心 UI 适配 %>
    <% if @pagy.pages > 1 %>
      <div class="px-6 py-4 bg-slate-50 border-t border-slate-200 flex flex-col sm:flex-row items-center justify-between gap-4">
        
        <%# 左侧：分页信息 %>
        <div class="text-xs text-slate-500 font-medium">
          <%== @pagy.info_tag %>
        </div>
        
        <%# 右侧：Pagy 导航器 
            使用任意选择器穿透修改 Pagy 自动生成的 HTML
            [&_nav]: 选中 nav 容器
            [&_a]: 选中所有页码链接
            [&_.current]: 选中当前活跃页
        %>
        <div class="flex items-center
                    [&_nav]:inline-flex [&_nav]:rounded-lg [&_nav]:shadow-sm [&_nav]:overflow-hidden [&_nav]:border [&_nav]:border-slate-300
                    [&_a]:px-4 [&_a]:py-2 [&_a]:text-sm [&_a]:font-bold [&_a]:text-slate-600 [&_a]:bg-white [&_a]:transition-colors [&_a]:no-underline
                    [&_a:hover]:bg-[#0066b3] [&_a:hover]:text-white
                    
                    <%# 当前页：背景变蓝，并加上 Navbar 同款橙色装饰条 %>
                    [&_.current]:px-4 [&_.current]:py-2 [&_.current]:text-sm [&_.current]:font-bold [&_.current]:bg-[#0066b3] [&_.current]:text-white [&_.current]:relative
                    [&_.current]:after:content-[''] [&_.current]:after:absolute [&_.current]:after:bottom-0 [&_.current]:after:left-0 [&_.current]:after:w-full [&_.current]:after:h-[3.5px] [&_.current]:after:bg-orange-400
                    
                    <%# 禁用状态和省略号 %>
                    [&_.disabled]:px-4 [&_.disabled]:py-2 [&_.disabled]:text-slate-300 [&_.disabled]:bg-slate-50 [&_.disabled]:cursor-not-allowed
                    [&_.gap]:px-4 [&_.gap]:py-2 [&_.gap]:text-slate-400 [&_.gap]:bg-slate-50">
          <%== @pagy.series_nav %>
        </div>
      </div>
    <% end %>

    <% if @drafts.empty? %>
      <div class="px-6 py-16 text-center text-slate-400 italic text-sm">
        未找到相关稿件记录
      </div>
    <% end %>
  </div>
</div>
